% !TEX root = z_output/_FormalGpsBook.tex
%%%USINGsubsectionNUMBERS

\documentclass[11pt]{article}
\input{../macros.tex}

\newcommand{\RAlg}{\mathsf{Alg}_R}
\newcommand{\RNil}{\mathsf{Nil}_R}
\newcommand{\SAlg}{\mathsf{Alg}_S}
\newcommand{\SNil}{\mathsf{Nil}_S}
\newcommand{\FSR}{\mathsf{FS}_R}
\newcommand{\FSS}{\mathsf{FS}_S}
\newcommand{\FGR}{\mathsf{FG}_R}
\newcommand{\FGLR}{\calF(R)}
\DeclareMathOperator{\SPec}{Sp}
\DeclareMathOperator{\SPf}{Spf}

\begin{document}
\section{Formal Geometry}
\subsection{$R$-sets and formal $R$-sets}
\begin{itemise}
\setlength{\parindent}{.25in}
\item An $R$-set is a functor $\RAlg\to\Set$. As the prime example, one takes the functor of points of a scheme.
\item Given an $R$-set $X$ and an element $x\in X(S)$, there is a natural evaluation map
\[\xymatrix@R=0mm{
\ar[r]^-{e_{S,x}}%Name of map
\RAlg(S,T)&%Source
X(T)\\%Target
f%x
\ar@{|->}[r]&
(Xf)(x)%f(x)
%\ar@{}[ul];[l]|{\rotatebox{90}{\tiny$\in$}} \ar@{}[u];[]|{\rotatebox{90}{\tiny$\in$}} 
}\]
If this map is an isomorphism of functors, we say that $X$ is represented by $(S,x)$.
\item Given $S\in\RAlg$, define the spectrum $\SPec S$ of $S$ to be the functor of points of $\spec S$:
\[\SPec S:\RAlg\to\Set\qquad T\mapsto \RAlg(S,T).\]
We'll say that an $R$-set is an \textbf{affine scheme} if it is represented by an $R$-algebra in this way. For example, we have the affine line, $\SPec(R[x])$, whose functor of points is $T\mapsto T$.
\item $R$-sets form a category which is not in general locally small, with morphisms the natural transformations. There is the evident \textbf{Yoneda lemma}, that the map
\[\xymatrix@R=0mm{
\ar[r]^-{}%Name of map
X(S)&%Source
\Map_R(\SPec S,X)\\%Target
x%x
\ar@{|->}[r]&
\left(\left(S\overset{f}{\to}T\right)\mapsto f(x)\right)%f(x)
}\]
is an isomorphism.
\hrule
\begin{shaded}
\item Consider the coslice (i.e.\ under) category $\calC_R:=(\spec R)/(R\mathsf{-Sch})$ of $R$-schemes $X$ equipped with a section $s$ of the structure map $X\to\Spec R$:
\[\xymatrix{
X
\ar[d]
\\%r1c2
\Spec R
\ar@/^1em/[u]^-{s}
}\]
The coYoneda embedding $\calC_R\to[\calC_R,\Set]^{\op}$, sending $X$ to its functor of points, is fully faithful.

Now there is a fully faithful functor $(\RAlg/R)^{\op}\overset{\spec}{\to}\calC_R$, whose essential image is the full subcategory of affine schemes in $\calC_R$. Now \rednote{I'm not sure whether the composite functor}:
\[\calC_R\to[\calC_R,\Set]^{\op}\overset{\spec^*}{\to}[(\RAlg/R)^{\op},\Set]^{\op}\]
is fully faithful. However, it's certain that  the composite with restriction
\[\calC_R\to[\calC_R,\Set]^{\op}\overset{\spec^*}{\to}[(\RAlg/R)^{\op},\Set]^{\op}\to[(\RNil)^{\op},\Set]^{\op}\]
is not faithful,
where $\RNil\subset \RAlg/R$ is the full subcategory of augmented $R$-algebras whose augmentation ideal is nilpotent. That is, we clearly cannot detect those parts of $X$ which are not close to the image of $s$ with maps from infinitessimal thickenings of $\spec R$!
\end{shaded}
\hrule
\item
\begin{itemize}\squishlist
\item Let $\RNil$ be the category of augmented (unital) $R$-algebras whose augmentation ideal is nilpotent. We'll call these \textbf{augmented $R$-algebras}.
\item Let $\RNil'$ be the category of non-unital $R$-algebras which are themselves nilpotent. We'll call these \textbf{nilpotent $R$-algebras}.
\end{itemize}
\noindent These two categories are equivalent.
\[\xymatrix@R=0mm{
\ar[r]^-{}%Name of map
\RNil&%Source
\RNil'\\%Target
(S,\epsilon)%x
\ar@{|->}[r]&
\ker(\epsilon)%f(x)
%\ar@{}[ul];[l]|{\rotatebox{90}{\tiny$\in$}} \ar@{}[u];[]|{\rotatebox{90}{\tiny$\in$}} 
}\qquad \xymatrix@R=0mm{
\ar[r]^-{}%Name of map
\RNil'&%Source
\RNil\\%Target
I%x
\ar@{|->}[r]&
(R\oplus I,\pi_1)%f(x)
%\ar@{}[ul];[l]|{\rotatebox{90}{\tiny$\in$}} \ar@{}[u];[]|{\rotatebox{90}{\tiny$\in$}} 
}\]
To understand this, note that the composite $\RNil'\to\RNil'$ equals the identity, while the composite $\RNil\to\RNil$, sending $(S,\epsilon)$ to $(R\oplus \ker\epsilon,\pi_1)$, is naturally isomorphic to the identity, as $\epsilon$ is always a splitting of the structure map $R\to S$.
\item Taking the set of augmented algebras gives a contravariant functor $\Rings\to\Cat$.
\[\xymatrix@R=0mm{
\ar[r]^-{f}%Name of map
R&%Source
S\\%Target
\ar[r];[]_-{f^*}%Name of map
\RNil&%Source
\SNil\\%Target
\makebox[0cm][r]{$T\times_S R=$\,}f^*T
\ar[r]
\ar@/^.5em/[dd]_{}="2"
&
T\ar@/^.5em/[dd]
\\\rule{0mm}{6mm}\\
R\ar@/^.5em/[uu]\ar[r]^-{f}
&
S\ar@/^.5em/[uu]^{}="1"
\ar@{|->}"1";"2"_-{f^*}
}\]
\item A \textbf{formal $R$-set} is a functor $X:\RNil\to\Set$ such that $X(R)=\{*\}$. These form a category $\FSR$ whose arrows are the natural transformations.

The point here is that $\textup{pt}$, then constant functor $\textup{pt}(S)=\{*\}$ is represented by the initial object $R\in\RNil$. By Yoneda's lemma, natural transformations $\textup{pt}\nt X$ are the same as elements of $X(R)$. We would rather like it if there was only one $R$-point of a formal $R$-scheme.
\item Given a map $f:R\to S$, one obtains a map $f:\FSR\to\FSS$ by composing with $f^*$.
\item We have a construction, called the `formal spectrum' :
\[\xymatrix@R=0mm{
\ar[r]^-{\SPf}%Name of map
\RAlg/R&%Source
\FSR\\%Target
(S,\epsilon)%x
\ar@{|->}[r]&
\SPf(S,\epsilon)\makebox[0cm][l]{\,$:=\RAlg((S,\epsilon),\DASH )$}%f(x)
%\ar@{}[ul];[l]|{\rotatebox{90}{\tiny$\in$}} \ar@{}[u];[]|{\rotatebox{90}{\tiny$\in$}} 
}\qquad \qquad \]
and a \textbf{formal Yoneda lemma}, that when we write $\kappa=\ker (\epsilon:S\to R),$ the natural map:
\[\xymatrix@R=0mm{
\ar[r]^-{}%Name of map
\Map_R(\SPf(S,\epsilon),X)&%Source
\varprojlim X\left(S/\kappa^{n+1}\right)\\%Target
\gamma%x
\ar@{|->}[r]&
\{\gamma(\pi_n)\}%f(x)
%\ar@{}[ul];[l]|{\rotatebox{90}{\tiny$\in$}} \ar@{}[u];[]|{\rotatebox{90}{\tiny$\in$}} 
}\]
is an isomorphism. 
To describe the natural map, consider the top half of the following diagram. Here, $\pi_n\in\SPf(S,\epsilon)(S/\kappa^{n+1})$, and applying $\gamma$ gives us a compatible sequence of points in $X(S/\kappa^{n+1})$.
\[\xymatrix{
&%r1c1
&%r1c2
S
\ar@{->>}[d]|-{\pi_{n+1}}
\ar@{->>}[dl]|-{\pi_{n}}
\ar@{->>}[dr]|-{\pi_{n+2}}
&%r1c3
&%r1c4
\\%r1c5
\cdots 
&%r2c1
S/\kappa^{n+1}
\ar@{->>}[l]
&%r2c2
S/\kappa^{n+2}
\ar@{->>}[l]^-{\rho_{n+1}}
&%r2c3
S/\kappa^{n+3}
\ar@{->>}[l]^-{\rho_{n+2}}
&%r2c4
\cdots 
\ar@{->>}[l]
%r2c5
\\%r1c5
\cdots 
&%r2c1
\Spec(S/\kappa^{n+1})
\ar@{^{(}->}[l];[]
\ar@{-->}[dr]^{}="1"_{}="2"
&%r2c2
\Spec(S/\kappa^{n+2})
\ar@{^{(}->}[l];[]^-{\rho_{n+1}^*}
\ar@{-->}[d]^{}="3"_{}="4"
&%r2c3
\Spec(S/\kappa^{n+3})
\ar@{^{(}->}[l];[]^-{\rho_{n+2}^*}
\ar@{-->}[dl]^{}="5"_{}="6"
&%r2c4
\cdots 
\ar@{^{(}->}[l];[]
%r2c5
\\
&&X
\ar@{|->}"3";"2"_-{\rho_{n+1}}
\ar@{|->}"5";"4"_-{\rho_{n+2}}
}\]
\noindent The second part of the diagram is supposed to motivate this when $X$ is a scheme. [I'm not sure what should be formal and what should not in such a motivation.] Note then that the inverse limit can be viewed as the intersection of the sets of $S/\kappa^{n+1}$-points as $n$ varies.

\item As an example of a formal spectrum, we have the formal line:
\[D=\SPf(R[[x]],\epsilon)\qquad \epsilon(x)=0.\qquad \qquad D(S,\epsilon)=\ker(\epsilon)\textup{ i.e.\ }D(I)=I.\]
\item $\Map_R(X,D)$ can be given the structure of a (possibly non-nilpotent) $R$-algebra without unit. To do this, it's best to think about nilpotent $R$-algebras. Suppose we are given $f,g:X\to D$. Then for any $I\in\RNil'$, we have maps $f_I,g_I:X(I)\to D(I)=I$ which can be added and multiplied pointwise. We define
\[\xymatrix@R=0mm{
\ar[r]^-{\calO}%Name of map
\FSR&%Source
\RAlg/R\\%Target
X%x
\ar@{|->}[r]&
R\oplus \Map_R(X,D)%f(x)
%\ar@{}[ul];[l]|{\rotatebox{90}{\tiny$\in$}} \ar@{}[u];[]|{\rotatebox{90}{\tiny$\in$}} 
}\]
So the situation is that we have functors
\[\xymatrix@R=.3cm{
&%r1c1
\RNil
\ar@/_1em/[ld]_-{\SPf}
\ar@{^{(}->}[d]
\\%r1c2
\FSR
\ar@<+.51ex>[r]^-{\calO}
&%r2c1
\RAlg/R
\ar@<+.51ex>[l]^-{\SPf}
%r2c2
}\]
Which form a contravariant adjunction --- there are maps:
\[
\vcenter{\xymatrix@1{
X
\ar[r]^-{\alpha_X}
&%r1c1
\SPf\calO_X
&%r1c2
&%r1c3
S
\ar[r]^-{\beta_S}
&%r1c4
\calO_{\SPf S}
%r1c5
}}\]
satisfying (contravariant) unit/counit identities.
To define $\alpha_X(S)$, for $(S,\epsilon)\in\RNil$, note that
\[(\SPf\calO_X)(S):=[\Map_R(X,D),\ker(\epsilon)]\]
and given $f:X\to D$, one has $f_S:X(S)\to D(S)=\ker(\epsilon)$. So given $x\in X(S)$, one has `evaluation at $x$', an element of $(\SPf\calO_X)(S)$. \rednote{I haven't written down how to define $\beta_S$ yet.}
\item A \textbf{formal scheme} is a formal $R$-set $X$ for which $\alpha_X$ is an isomorphism. This occurs \Iff $X$ is isomorphic to a the formal spectrum of some augmented $R$-algebra.
\item By the formal Yoneda lemma, we have an equality
\[S\overset{\beta_S}{\to}\calO_{\SPf S}\cong \varprojlim S/I^n.\]
Fortunately, the composite is the map to the $I$-completion of $S$.
\end{itemise}
\subsection{Formal groups}
\begin{itemise}
\setlength{\parindent}{.25in}
\item A \textbf{$R$-group} is:
\begin{itemize}\squishlist
\setlength{\parindent}{.25in}
\item  a group in the category of $R$-sets, i.e.
\item a functor $\RAlg\to\mathsf{Groups}$.
\end{itemize}
For example, we have the general linear group-scheme $\GL_n$, sending $S\mapsto \GL_n(S)$. This is an \textbf{affine group-scheme}, as it is represented by the algebra $R[a_{ij},d]/(d\det[a_{ij}]-1)$.

Affine group schemes are the same thing as Hopf algebras.
\item A \textbf{formal $R$-group functor} is:
\begin{itemize}\squishlist
\setlength{\parindent}{.25in}
\item  a group in the Category of formal $R$-sets, i.e.
\item a functor $\RNil\to\mathsf{Groups}$.
\end{itemize}
\item A \textbf{formal group-scheme} is a formal $R$-group functor which underlying formal $R$-set is a formal scheme.
\item A formal $R$-group functor is a \textbf{formal group} if it is:
\begin{itemize}\squishlist
\setlength{\parindent}{.25in}
\item commutative; and
\item isomorphic as a formal set to the formal line $D$.
\end{itemize}
Write $\FGR$ for the category of formal groups over $R$.
An isomorphism $x:D\to G$ is called a \textbf{parameter} on $G$.
\item For example, we have the \textbf{additive} formal group, the functor
\[\xymatrix@R=4mm{
&%r1c1
{{_R}\mathsf{Mod}}
\ar[d]^-{U}
&%r1c2
&%r1c3
&%r1c4
\ker(\epsilon)\ar@{|->}[d]
\\%r1c5
\ar[ur]^-{{G}_a}
\RNil
\ar[r]_-{{G}_a}
&%r2c1
\Set
&%r2c2
&%r2c3
(S,\epsilon)
\ar@{|->}[r]
\ar@{|->}[ur]
&%r2c4
\ker(\epsilon)%r2c5
}\]
Anything isomorphic to a composite $\RNil\overset{{G}_a}{\to}{{_R}\mathsf{Mod}}\overset{{M}\otimes_{R}{\DASH }}{\to}{{_R}\mathsf{Mod}}$ is called \textbf{additive}.

We also have the \textbf{multiplicative} formal group law: ${G}_m(S,\epsilon):=1+\ker(\epsilon)$. As $I$ is nilpotent, this is a subgroup of the multiplicative monoid $S$.
\end{itemise}
\subsection{Completion}
\begin{itemise}
\setlength{\parindent}{.25in}
\item \rednote{(I suppose that)} a \textbf{point} of an $R$-set $X$ is a map from the constant functor $\ast:\RAlg\to\Set$ to $X$. \textbf{Completion} will be a way to obtain a formal $R$-set $\hat{X}$ from a $R$-set $X$ and a point $a$ of $X$. We define it by taking a pullback. $\hat X$ assigns to an augmented $R$-algebra $(S,\epsilon)$ the pullback in
\[\xymatrix{
\hat X(S) %Top Left
\ar[r]   %Top arrow
\ar[d]   %Left arrow
\ar@{}[rd]|{\textup{p.b.}}&
X(S) %Top Right
\ar[d]^-{X(\epsilon)}\\ %Right arrow
\ast %Bottom Left
\ar[r]_-{a_R}&  %Bottom arrow
X(R)  %Bottom right
}\]
To motivate this, if $X$ is the functor of points of an $R$-scheme $X$, then a point of $X$ includes a map $\spec R\uparrow X$ which is a section of the structure map $X\downarrow\spec R$. Then:% this pullback consists of those maps
\[\hat X(S):=\left\{\spec S\to X\ \middle|\ 
\vcenter{\xymatrix@R=4mm@1{
\spec S
\ar[r]
&%r1c1
X\\%r1c2
\spec R
\ar[u]^-{\epsilon^\#}
\ar[ur]_-{a_R}
&%r2c1
%r2c2
}}\textup{\ commutes}\right\}\]
That is, $\hat X(S)$ is the set of $S$-points of $X$ which preserve the copy of $R$ living in $X$.
\item In particular, given an augmented algebra $(S,\epsilon)$, $\epsilon$ determines a point $a$ of $\SPec S$, and the completion at that point is $\SPf(S,\epsilon)$.
\item Completion preserves limits, and so given an $R$-group, taking completions, one obtains a formal $R$-group functor.
\item Fortunately:
\[\hat{\mathbb{G}}_a=G_a\qquad \textup{and}\qquad \hat{\mathbb{G}}_m=G_m.\]
\end{itemise}
\subsection{Jets}
\begin{itemise}
\setlength{\parindent}{.25in}
\item Let $\RNil(n)\subset \RNil$ be the full subcategory in which $(\ker\epsilon)^{n+1}=0$.
\item If $f,g:X\to Y$ are maps of formal $R$-sets, write $f\sim_n g$ if $f$ and $g$ induce the same map on $S$-points for $S\in\RNil(n)$. That is, if $f|_{\RNil(n)}=g|_{\RNil(n)}$. Write
\[J^n_R(X,Y)=\Map_R(S,Y)/\sim_n\textup{\quad the set of \textbf{$n$-jets of maps $X$ to $Y$}.}\]
\begin{shaded}
One should think here that given two maps $f,g:X\to Y$ in the category $\calC_R$, views the maps as giving the same $n$-jet if whenever $Z$ is a thickening of $\spec R$ of \rednote{height/length/depth/whatever} $n$, the two composites $Z\to X\to Y$ are equal.
\end{shaded}
This gives a tower
\[\ast=J^0(X,Y)\leftarrow J^1(X,Y)\leftarrow J^2(X,Y)\leftarrow\cdots, \]
and categories whose morphisms are the $n$-jets.
\item We define the \textbf{tangent space} of a \textbf{formal} $R$-set $Y$ to be $TY=J_R^1(D,Y)$.
\begin{itemize}\squishlist
\setlength{\parindent}{.25in}
\item $Y$ being formal has only one point, so there's no need to specify it.
\item By formal Yoneda, we have an isomorphism
\[\xymatrix@R=0mm{
\ar[r]^-{}%Name of map
\Map_R(D,Y)&%Source
\varprojlim Y\left(R[x]/x^{n+1}\right)
}\]
and moreover, $J^n_R(D,Y)=Y(R[x]/x^{n+1})$. Thus
$TY= Y(R[x]/x^2)$.
\item $TY$ is an $R$-module. To define the structure, note that for $r\in R$, one obtains an $R$-algebra endomorphism of $R[x]/x^2$ by multiplying $x$ by $r$. Applying $Y$ to these endomorphisms give the module structure.
\end{itemize}
\rednote{There's some discussion here which I'm not following. In fact, I'll return to the stuff to chapter 2 later.}
\end{itemise}
\section{Formal Group Laws}
\subsection{Formal Group Laws}
\begin{itemise}
\setlength{\parindent}{.25in}
\item A \textbf{formal group law} is a formal group whose underlying formal scheme \textbf{\underline{is}} $D$. Thus formal group laws form a \emph{full subcategory} $\FGLR$ of the category $\FGR$ of formal groups.
\item As the product $D\times D$ in $\FGR$ is $\SPf(R[[u,v]])$ \rednote{(is it?)}, a formal group law in the above sense gives a power series $F(u,v)$ as expected.
\end{itemise}
\rednote{Is the obvious definition of homomorphism actually the definition in the category of formal groups? At the start of 2.3, it doesn't seem as though this is obvious.}
\subsection{Formal Groups over $\Q$-algebras}
\begin{itemise}
\setlength{\parindent}{.25in}
\item There is a universal `strict conjugate' of the additive formal group law given by
\[G_a^{\log}(x,y)=\exp(\log(x)+\log(y))\]
Over $M=\Z[l_1,l_2,\ldots]$, where $\log(t)=\sum_{i\geq1}l_{i-1}t^i$ (and $l_0=1$).
\item If $R$ is a $\Q$-algebra, and FGL $G$ over $R$ is isomorphic to $G_a$ by a unique strict isomorphism $\log_G:G\to G_a$.
\item For any two formal group laws $F,G$ over a $\Q$-algebra $R$, we have an isomorphism
\[\Hom_R(F,G)\to R\qquad \theta\mapsto\theta'(0).\]
\end{itemise}
\subsection{The endomorphism ring of $G_a$}
\begin{itemise}
\setlength{\parindent}{.25in}
\item Although there's  \rednote{something foggy} here, automorphisms of $G_a$ are determined by additive power series.
\item Over a $\Q$-algebra, any endomorphism of $G_a$ reduces (by differentiation) to $ax$, so that as a functor $E:\mathsf{Alg}_\Q\to\Rings$, `the endomorphism ring of $G_a$' is just the inclusion of categories.
\item This inclusion of categories is represented by the ring $\Q(t)$, giving $\Q(t)$ the structure of co-ring object in $\Rings$. This needs two diagonal maps, one for each of addition and multiplication. One finds that
\begin{alignat*}{2}
\Delta_+(t)
&=
1\otimes t+t\otimes 1%
&\qquad&\text{(primitive)}\\
% Left hand side
\Delta_\times (t)
% Relation
&=
% Right hand side
t\otimes t%
% Comment
&\qquad&\text{(grouplike)}
\end{alignat*}

\end{itemise}
\end{document}




